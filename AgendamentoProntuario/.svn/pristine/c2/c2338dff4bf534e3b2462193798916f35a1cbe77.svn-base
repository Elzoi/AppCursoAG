import { Observable } from 'rxjs/Observable'
import { Injectable, OnInit } from '@angular/core'
import { Router, ActivatedRoute } from '@angular/router';

import { HttpRequestService } from '../sharead/httpRequest.service'
import { AlertService } from '../sharead/alert.service'
import { Usuario } from '../_model/usuario.model'
import { error } from 'util';
import { SessionService } from '../sharead/session.service';

@Injectable()
export class AutenticacaoService{

    private returnUrl: string = ''
    
    constructor(
        private session: SessionService,
        private http: HttpRequestService,
        private alertService: AlertService,
        private route: ActivatedRoute,
        private router: Router
    ){}

    ngOnInit(){}

    public login(cpf: string, matricula: string): void{
        this.http.getSessionUsuario(cpf, matricula)
        .subscribe(
            (usuario: Usuario) =>{
                this.session.setUser(usuario)
                this.router.navigate([this.returnUrl]);
            },
            error =>{
                this.alertService.error('CPF ou Número de Matricula inválido.')
            })
    }

    public logout(){
        this.session.restartSession()
    }
}